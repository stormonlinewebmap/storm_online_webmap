<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>الخريطة التفاعلية لشبكات السيول</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: Arial, sans-serif;
    direction: rtl;
    background: #f3f4f6;
    overflow: hidden;
}

#header {
    background: rgb(36,109,37);
    color: white;
    text-align: center;
    padding: 14px;
}

#loginOverlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

#loginBox {
    background: white;
    padding: 22px;
    border-radius: 10px;
    width: 90%;
    max-width: 340px;
    text-align: center;
}

#loginBox input, #loginBox button {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    font-size: 16px;
}

#loginBox button {
    background: rgb(36,109,37);
    color: white;
    border: none;
    border-radius: 6px;
}

#errorMsg {
    color: #b91c1c;
    margin-top: 10px;
}

#map-container {
    position: absolute;
    top: 52px;
    left: 0;
    right: 0;
    bottom: 0;
    display: none;
    background: white;
}

iframe {
    width: 100%;
    height: 100%;
    border: none;
}
</style>
</head>

<body>

<div id="header">إدارة تصميم ودراسة شبكات السيول</div>

<div id="loginOverlay">
    <div id="loginBox">
        <h3>تسجيل الدخول</h3>
        <input id="username" placeholder="اسم المستخدم">
        <input id="password" type="password" placeholder="كلمة المرور">
        <button onclick="checkLogin()">دخول</button>
        <div id="errorMsg"></div>
    </div>
</div>

<div id="map-container">
    <iframe id="mapFrame"></iframe>
</div>

<script>
const USERS = [
    { username: "admin", password: "123" },
    { username: "user1", password: "111" },
    { username: "user2", password: "222" },
    { username: "Abu Yousef", password: "Yousef1983" },
    { username: "Monamour", password: "9090" },
    { username: "mogo50", password: "m2010" },
    { username: "Mowafy", password: "2907" },
    { username: "Maher21295@gmail.com", password: "Ff010975*" },
    { username: "Mtarek", password: "M123" },
    { username: "Mohammad", password: "Moh123" },
    { username: "Engsultan", password: "S123" },
    { username: "MAsiri", password: "M123" },
    { username: "user3", password: "333" }
];

let mapLoaded = false;

function checkLogin() {
    const u = username.value.trim();
    const p = password.value.trim();
    const err = errorMsg;

    const ok = USERS.find(x => x.username === u && x.password === p);
    if (!ok) {
        err.textContent = "بيانات الدخول غير صحيحة";
        return;
    }

    sessionStorage.setItem("loggedIn", "1");

    document.getElementById("loginOverlay").style.display = "none";

    // تحميل الخريطة بتأخير (حل مشكلة iOS)
    setTimeout(loadMap, 800);

    // الموقع بدون تعطيل الصفحة
    navigator.geolocation.getCurrentPosition(pos => {
        fetch("https://api.ipify.org?format=json")
        .then(r => r.json())
        .then(d => sendToGoogle(u, d.ip, pos.coords.latitude, pos.coords.longitude))
        .catch(()=>{});
    }, ()=>{}, { timeout: 5000 });
}

function loadMap() {
    if (mapLoaded) return;
    mapLoaded = true;
    document.getElementById("map-container").style.display = "block";
    mapFrame.src = "https://www.arcgis.com/apps/mapviewer/index.html?webmap=c547b98159744cacb7a42db1c060bf64";
}

window.onload = () => {
    if (sessionStorage.getItem("loggedIn")) {
        document.getElementById("loginOverlay").style.display = "none";
        loadMap();
    }
};

function sendToGoogle(user, ip, lat, lon) {
    fetch("https://script.google.com/macros/s/AKfycbxdgRaxLQxrDkP_--wuX_H9RueEnKkTYhDhy-O_QgJDZQPpXmOANOZhbGjN8lNrqYtY/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `user=${encodeURIComponent(user)}&ip=${encodeURIComponent(ip)}&lat=${lat}&lon=${lon}`
    }).catch(()=>{});
}
</script>

</body>
</html>




